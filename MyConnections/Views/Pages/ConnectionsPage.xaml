<Page
    x:Class="MyConnections.Views.Pages.ConnectionsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MyConnections.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
	xmlns:conv="clr-namespace:MyConnections.Converters"
	xmlns:usrctrl="clr-namespace:MyConnections.UserControls"
	xmlns:models="clr-namespace:MyConnections.Models"
    Title="DashboardPage"
    d:DataContext="{d:DesignInstance local:ConnectionsPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">
	<Page.Resources>
		<conv:ProcessPathToIconConverter x:Key="ExeIconConverter"/>

		<DrawingImage x:Key="GrayCirclePlaceholder">
			<DrawingImage.Drawing>
				<DrawingGroup>
					<GeometryDrawing Brush="Gray">
						<GeometryDrawing.Geometry>
							<EllipseGeometry Center="16,16" RadiusX="16" RadiusY="16"/>
						</GeometryDrawing.Geometry>
					</GeometryDrawing>
				</DrawingGroup>
			</DrawingImage.Drawing>
		</DrawingImage>
	</Page.Resources>

	<Grid VerticalAlignment="Top">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

		<!--- Pseudo-Menu -->
		<StackPanel Grid.Row="0" 
					Grid.Column="0" Grid.ColumnSpan="1"
					Orientation="Horizontal">
			<ui:Button
                    Content="Refresh" 
				Command="{Binding ViewModel.RefreshConnectionCommand}"
                    Icon="{ui:SymbolIcon ArrowClockwise24}" />
			<ui:Button
                    Content="Kill Connection"
				    Margin="4,0,0,0"
                    Icon="{ui:SymbolIcon Delete24}" />
			<ui:Button
                    Content="End Process"
				    Margin="4,0,0,0"
                    Icon="{ui:SymbolIcon RecordStop24}" />
		</StackPanel>

		<ui:ListView Grid.Row="1" 
					 Grid.Column="0" Grid.ColumnSpan="2"
					 HorizontalAlignment="Stretch"
					 VerticalAlignment="Stretch"
					 Width="Auto"
					 Margin="0,12,0,0"
					 ItemsSource="{Binding ViewModel.Connections, Mode=TwoWay}"
					 SelectedIndex="1"
					 SelectionMode="Single">
			<ui:ListView.ItemTemplate>
				<DataTemplate DataType="{x:Type models:NetworkConnectionInfo}">
					<Grid Margin="8,0">
						<Grid.RowDefinitions>
							<RowDefinition Height="*" />
							<RowDefinition Height="*" />
						</Grid.RowDefinitions>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
						</Grid.ColumnDefinitions>
						<!-- Image that shows the real exe icon -->
						<Image Width="32" Height="32" Margin="0,6,0,0"
							   Source="{Binding ProcessPath, Converter={StaticResource ExeIconConverter}, 
									TargetNullValue={StaticResource GrayCirclePlaceholder}, 
									FallbackValue={StaticResource GrayCirclePlaceholder}}"
							   VerticalAlignment="Center" HorizontalAlignment="Center"/>
						<!-- Full process path -->
						<TextBlock Grid.Row="0"
								   Grid.Column="1" Grid.ColumnSpan="2"
								   Margin="12,12,0,0"
								   FontWeight="Bold"
								   Text="{Binding ProcessPath, Mode=OneWay}" />
						<!-- remote IP & port -->
						<TextBlock Grid.Row="1"
								   Grid.Column="1"
								   Margin="12,0,0,0"
								   FontWeight="Bold"
								   HorizontalAlignment="Left"
								   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
								   Text="{Binding RemoteConnection, Mode=OneWay}" />
						<!-- local IP & port -->
						<TextBlock Grid.Row="1"
								   Grid.Column="2"
								   Margin="12,0,0,0"
								   HorizontalAlignment="Right"
								   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
								   Text="{Binding LocalConnection, Mode=OneWay}" />
					</Grid>
				</DataTemplate>
			</ui:ListView.ItemTemplate>
		</ui:ListView>

		<usrctrl:ProgressRing
			Grid.Row="2"
			Grid.Column="0"
            Width="32"
            Background="Transparent"
            Foreground="Blue" />
		<TextBlock
			Grid.Row="1"
            Grid.Column="1"
            Margin="12,0,0,0"
            VerticalAlignment="Center"
            Text="{Binding ViewModel.Counter, Mode=OneWay}" />
    </Grid>
</Page>
