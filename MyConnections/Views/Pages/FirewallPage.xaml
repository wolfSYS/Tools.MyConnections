<Page
    x:Class="ConnectionMgr.Views.Pages.FirewallPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:conv="clr-namespace:ConnectionMgr.Converters"
    xmlns:local="clr-namespace:ConnectionMgr.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="HostsFileEditPage"
    d:DataContext="{d:DesignInstance local:FirewallPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
	ScrollViewer.CanContentScroll="False"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">
    <Page.Resources>
		<conv:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
		<conv:EmptyCountToVisibilityConverter x:Key="EmptyCountToVisible" />
		<conv:EmptyCountToCollapsedConverter x:Key="EmptyCountToCollapsed" />
		<conv:StripAppTagFromFwRuleConverter x:Key="StripTagConverter" />
		<conv:FirewallEnabledStateToImage x:Key="FwEnabledStateConverter" />
		<BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Page.Resources>

	<Grid VerticalAlignment="Top">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<!--- Pseudo-Menu -->
		<StackPanel Grid.Row="0"
					Orientation="Horizontal">
			<ui:Button Content="Enable"
					   ToolTip="Enables the deactivated Rule"
					   Command="{Binding ViewModel.EnableRuleCommand}"
					   CommandParameter="{Binding ViewModel.CurrentSelection}"
					   Icon="{ui:SymbolIcon FlashCheckmark24}" />
			<ui:Button Content="Disable"
					   ToolTip="Disables the active Rule"
					   Command="{Binding ViewModel.DisableRuleCommand}"
					   CommandParameter="{Binding ViewModel.CurrentSelection}"
					   Margin="4,0,0,0"
					   Icon="{ui:SymbolIcon SquareDismiss16}" />
			<ui:Button Content="Delete"
					   ToolTip="Removes the Rule from the Firewall"
					   Command="{Binding ViewModel.DeleteRuleCommand}"
					   CommandParameter="{Binding ViewModel.CurrentSelection}"
					   Margin="4,0,0,0"
					   Icon="{ui:SymbolIcon Delete24}" />
			<ui:Button Content="Open Firewall"
					   ToolTip="Opens the Windows Firewall"
					   Command="{Binding ViewModel.OpenWindowsFirewallCommand}"
					   Margin="4,0,0,0"
					   Icon="{ui:SymbolIcon WindowShield24}" />
			<!-- ProgressRing -->
			<ui:ProgressRing IsIndeterminate="True"
						 Height="28" Width="28"
						 Margin="36,0,0,0"
						 Visibility="{Binding ViewModel.ShowProgress, Converter={StaticResource BoolToVis}}" />
		</StackPanel>

		<!-- our own Firewall rules here -->
		<ui:DataGrid Grid.Row="1"
					 x:Name="FirewallGrid"
					 VerticalContentAlignment="Stretch"
					 HorizontalContentAlignment="Stretch"
					 AutoGenerateColumns="False"
					 SelectionMode="Single"
					 IsReadOnly="True"
					 Visibility="{Binding ViewModel.Rules.Count, Converter={StaticResource EmptyCountToCollapsed}}"
					 ItemsSource="{Binding ViewModel.Rules, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
					 SelectedItem="{Binding ViewModel.CurrentSelection, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" >
			<ui:DataGrid.Columns>
				<DataGridTextColumn Header="Name" Width="260">
					<DataGridTextColumn.Binding>
						<Binding Path="Name" Converter="{StaticResource StripTagConverter}"/>
					</DataGridTextColumn.Binding>
				</DataGridTextColumn>
				<DataGridTemplateColumn Width="80" Header="Enabled">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Image Source="{Binding IsEnable, Converter={StaticResource FwEnabledStateConverter}}" Width="14" Height="14" />
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
				<DataGridTextColumn Header="Local Port" Binding="{Binding LocalPorts[0]}" />
				<DataGridTextColumn Header="Service" Binding="{Binding ServiceName}" />
				<DataGridTextColumn Header="Application" Binding="{Binding ApplicationName}" FontSize="12" />
			</ui:DataGrid.Columns>
		</ui:DataGrid>
		
		<!-- when DataGrid has no content -->
		<StackPanel Grid.Row="1"
					HorizontalAlignment="Stretch"
					VerticalAlignment="Center"
					Height="400"
					Visibility="{Binding ViewModel.Rules.Count, Converter={StaticResource EmptyCountToVisible}}">
			<TextBlock Margin="0,128,0,0"
                FontSize="20"
                FontWeight="Medium"
				HorizontalAlignment="Center"
				VerticalAlignment="Center"
                Text="Na data to display" />
			<TextBlock Margin="0,12,0,0"
                FontSize="14"
				HorizontalAlignment="Center"
				VerticalAlignment="Center"
                Text="You haven't added any rules to the Windows Firewall via this App yet." />
			<TextBlock Margin="0,12,0,0"
                FontSize="13"
				HorizontalAlignment="Center"
				VerticalAlignment="Center"
                Text="Only rules added via ConnectionMgr will show up here." />
			<TextBlock Margin="0,4,0,0"
                FontSize="13"
				HorizontalAlignment="Center"
				VerticalAlignment="Center"
                Text="If you want to manage all Firewall rules, please click the 'Open Firewall' button." />
		</StackPanel>

	</Grid>
</Page>
